<?xml version="1.0"?>
<project name="Embedded CST316 Project Test Build" default="targets" basedir=".">
    
    <!-- set global properties for this build -->
    <property name="src" location="airAutomation/src" />
	<property name="test" location="airAutomation/testAirUI/airUI/pkg" />
	<property name="aTest" location="airAutomation/testAirUI" />
    <property name="build" location="airAutomation/classes" />
    <property name="test.dir" location="airAutomation/classes/tests" />
    <property name="test.report.dir" location="airAutomation/testreport" />
    <property name="lib" location="airAutomation/lib" />
    
    <path id="test.class.path">
        <pathelement location="${build}" />
        <pathelement location="${lib}/xbjlib-1.0.1.jar" />
    	<pathelement location="${lib}/junit-4.12.jar" />
    	<pathelement location="${lib}/hamcrest-core-1.3.jar" />
    	<pathelement location="${lib}/findbugs-ant.jar" />
    	<pathelement location="${lib}/findbugs.jar" />
    	<pathelement location="${lib}/pmd-core-5.2.3.jar" />
    	<pathelement location="${lib}/pmd-java-5.2.3.jar" />
    </path>
    
    <taskdef name="pmd" classname="net.sourceforge.pmd.ant.PMDTask" classpathref="test.class.path" />
    <taskdef name="findbugs" classname="edu.umd.cs.findbugs.anttask.FindBugsTask" classpath="${lib}/findbugs-ant.jar"/>
    
    <path id="compile.class.path">
        <pathelement location="${build}" />
        <pathelement location="${lib}/xbjlib-1.0.1.jar" />
    </path>
    
    <target name="targets">
        <!-- Display available targets -->
        <echo message="targets are clean, prepare, compile.test, test, build, execute"/>
    </target>
    
    <target name="clean">
        <!-- Delete the ${build} directory tree -->
        <delete dir="${build}" />
        <delete dir="${test.report.dir}" />
        <delete dir="${test.dir}" />
    </target>
    
    <target name="prepare">
        <!-- Create the time stamp -->
        <tstamp/>
        <!-- Create the build directory structure used by compile -->
        <mkdir dir="${build}" />
        <mkdir dir="${test.dir}" />
        <mkdir dir="${test.report.dir}" />
    </target>
    
    <target name="compile.test" depends="clean, prepare" description="Compile Unit Tests">
        <!-- Compile all classes -->
        <javac srcdir="${src}"
            includeantruntime="false"
            destdir="${build}" >
            <classpath refid="test.class.path" />
        </javac>
        <javac srcdir="${test}"
            includeantruntime="false"
            destdir="${test.dir}" >
            <classpath refid="test.class.path" />
        </javac>
    </target>
    
    <target name="test" depends="compile.test" description="Execute Unit Tests">
        <!-- Run Junit tests -->
    	<property name="test.path" refid="test.class.path"/>
    	<echo message="Junit Class Path Is: ${junit.path}"/>
        <junit printsummary="true" fork="true" haltonfailure="yes">
            <classpath refid="test.class.path" />
            <classpath>
                <pathelement location="${test.dir}" />
            </classpath>
            <formatter type="xml" />
            <batchtest fork="true" todir="${test.report.dir}">
                <fileset dir="${aTest}">
                    <include name="**/**Test.java" />
                </fileset>
            </batchtest>
        </junit>
         <pmd shortFilenames="true">
         <sourceLanguage name="java" version="1.8"/>
         <ruleset>rulesets/java/design.xml</ruleset>
         <ruleset>java-basic</ruleset>
         <ruleset>java-naming</ruleset>
         <ruleset>java-empty</ruleset>
         <auxclasspath refid="test.class.path"/>
         <formatter type="xml" toFile="${test.report.dir}/pmd.xml">
         <param name="linkPrefix" value="http://pmd.sourceforge.net/xref/"/>
         </formatter>
         <fileset dir="${src}">
         <include name="**/*.java"/>
         </fileset>
         </pmd>
         <findbugs home="lib" output="xml" outputFile="{test.report.dir}/findbugs.xml">
         <auxClasspath refid="test.class.path"/>
         <sourcePath path="${src}"/>
         <class location="${build}"/>
         </findbugs>
    </target>
    
    <target name="build" depends="clean, prepare" description="Compile class files for program execution">
        <!-- build project files -->
        <echo message="Build source files" />
        <javac srcdir="${src}"
            includeantruntime="false"
            destdir="${build}">
            <classpath refid="compile.class.path"/>
        </javac>
    </target>
    
    <target name="execute" depends="build" description="Run Program">
        <!-- Execute the program -->
        <echo message="Compile and execute AirUI Program" />
        <java classname="airUI/pkg/MainDriver" fork="yes">
            <classpath refid="compile.class.path"/>
        </java>
    </target>
</project>
